const config={url:"http://log.tongji.qinglizi.cn"};var CryptoJS=CryptoJS||function(t,e){var r={},i=r.lib={},s=function(){},n=i.Base={extend:function(t){s.prototype=this;var e=new s;return t&&e.mixIn(t),e.hasOwnProperty("init")||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},a=i.WordArray=n.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:4*t.length},toString:function(t){return(t||c).stringify(this)},concat:function(t){var e=this.words,r=t.words,i=this.sigBytes;if(t=t.sigBytes,this.clamp(),i%4)for(var s=0;s<t;s++)e[i+s>>>2]|=(r[s>>>2]>>>24-s%4*8&255)<<24-(i+s)%4*8;else if(65535<r.length)for(s=0;s<t;s+=4)e[i+s>>>2]=r[s>>>2];else e.push.apply(e,r);return this.sigBytes+=t,this},clamp:function(){var e=this.words,r=this.sigBytes;e[r>>>2]&=4294967295<<32-r%4*8,e.length=t.ceil(r/4)},clone:function(){var t=n.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var r=[],i=0;i<e;i+=4)r.push(4294967296*t.random()|0);return new a.init(r,e)}}),o=r.enc={},c=o.Hex={stringify:function(t){var e=t.words;t=t.sigBytes;for(var r=[],i=0;i<t;i++){var s=e[i>>>2]>>>24-i%4*8&255;r.push((s>>>4).toString(16)),r.push((15&s).toString(16))}return r.join("")},parse:function(t){for(var e=t.length,r=[],i=0;i<e;i+=2)r[i>>>3]|=parseInt(t.substr(i,2),16)<<24-i%8*4;return new a.init(r,e/2)}},_=o.Latin1={stringify:function(t){var e=t.words;t=t.sigBytes;for(var r=[],i=0;i<t;i++)r.push(String.fromCharCode(e[i>>>2]>>>24-i%4*8&255));return r.join("")},parse:function(t){for(var e=t.length,r=[],i=0;i<e;i++)r[i>>>2]|=(255&t.charCodeAt(i))<<24-i%4*8;return new a.init(r,e)}},u=o.Utf8={stringify:function(t){try{return decodeURIComponent(escape(_.stringify(t)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(t){return _.parse(unescape(encodeURIComponent(t)))}},h=i.BufferedBlockAlgorithm=n.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=u.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var r=this._data,i=r.words,s=r.sigBytes,n=this.blockSize,o=s/(4*n);if(e=(o=e?t.ceil(o):t.max((0|o)-this._minBufferSize,0))*n,s=t.min(4*e,s),e){for(var c=0;c<e;c+=n)this._doProcessBlock(i,c);c=i.splice(0,e),r.sigBytes-=s}return new a.init(c,s)},clone:function(){var t=n.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});i.Hasher=h.extend({cfg:n.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,r){return new t.init(r).finalize(e)}},_createHmacHelper:function(t){return function(e,r){return new d.HMAC.init(t,r).finalize(e)}}});var d=r.algo={};return r}(Math);!function(){var t=CryptoJS,e=t.lib.WordArray;t.enc.Base64={stringify:function(t){var e=t.words,r=t.sigBytes,i=this._map;t.clamp(),t=[];for(var s=0;s<r;s+=3)for(var n=(e[s>>>2]>>>24-s%4*8&255)<<16|(e[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|e[s+2>>>2]>>>24-(s+2)%4*8&255,a=0;4>a&&s+.75*a<r;a++)t.push(i.charAt(n>>>6*(3-a)&63));if(e=i.charAt(64))for(;t.length%4;)t.push(e);return t.join("")},parse:function(t){var r=t.length,i=this._map;(s=i.charAt(64))&&(-1!=(s=t.indexOf(s))&&(r=s));for(var s=[],n=0,a=0;a<r;a++)if(a%4){var o=i.indexOf(t.charAt(a-1))<<a%4*2,c=i.indexOf(t.charAt(a))>>>6-a%4*2;s[n>>>2]|=(o|c)<<24-n%4*8,n++}return e.create(s,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(t){function e(t,e,r,i,s,n,a){return((t=t+(e&r|~e&i)+s+a)<<n|t>>>32-n)+e}function r(t,e,r,i,s,n,a){return((t=t+(e&i|r&~i)+s+a)<<n|t>>>32-n)+e}function i(t,e,r,i,s,n,a){return((t=t+(e^r^i)+s+a)<<n|t>>>32-n)+e}function s(t,e,r,i,s,n,a){return((t=t+(r^(e|~i))+s+a)<<n|t>>>32-n)+e}for(var n=CryptoJS,a=(c=n.lib).WordArray,o=c.Hasher,c=n.algo,_=[],u=0;64>u;u++)_[u]=4294967296*t.abs(t.sin(u+1))|0;c=c.MD5=o.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,n){for(var a=0;16>a;a++){var o=t[c=n+a];t[c]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}a=this._hash.words;var c=t[n+0],u=(o=t[n+1],t[n+2]),h=t[n+3],d=t[n+4],p=t[n+5],f=t[n+6],l=t[n+7],g=t[n+8],m=t[n+9],y=t[n+10],v=t[n+11],k=t[n+12],S=t[n+13],C=t[n+14],w=t[n+15],A=e(A=a[0],P=a[1],x=a[2],b=a[3],c,7,_[0]),b=e(b,A,P,x,o,12,_[1]),x=e(x,b,A,P,u,17,_[2]),P=e(P,x,b,A,h,22,_[3]);A=e(A,P,x,b,d,7,_[4]),b=e(b,A,P,x,p,12,_[5]),x=e(x,b,A,P,f,17,_[6]),P=e(P,x,b,A,l,22,_[7]),A=e(A,P,x,b,g,7,_[8]),b=e(b,A,P,x,m,12,_[9]),x=e(x,b,A,P,y,17,_[10]),P=e(P,x,b,A,v,22,_[11]),A=e(A,P,x,b,k,7,_[12]),b=e(b,A,P,x,S,12,_[13]),x=e(x,b,A,P,C,17,_[14]),A=r(A,P=e(P,x,b,A,w,22,_[15]),x,b,o,5,_[16]),b=r(b,A,P,x,f,9,_[17]),x=r(x,b,A,P,v,14,_[18]),P=r(P,x,b,A,c,20,_[19]),A=r(A,P,x,b,p,5,_[20]),b=r(b,A,P,x,y,9,_[21]),x=r(x,b,A,P,w,14,_[22]),P=r(P,x,b,A,d,20,_[23]),A=r(A,P,x,b,m,5,_[24]),b=r(b,A,P,x,C,9,_[25]),x=r(x,b,A,P,h,14,_[26]),P=r(P,x,b,A,g,20,_[27]),A=r(A,P,x,b,S,5,_[28]),b=r(b,A,P,x,u,9,_[29]),x=r(x,b,A,P,l,14,_[30]),A=i(A,P=r(P,x,b,A,k,20,_[31]),x,b,p,4,_[32]),b=i(b,A,P,x,g,11,_[33]),x=i(x,b,A,P,v,16,_[34]),P=i(P,x,b,A,C,23,_[35]),A=i(A,P,x,b,o,4,_[36]),b=i(b,A,P,x,d,11,_[37]),x=i(x,b,A,P,l,16,_[38]),P=i(P,x,b,A,y,23,_[39]),A=i(A,P,x,b,S,4,_[40]),b=i(b,A,P,x,c,11,_[41]),x=i(x,b,A,P,h,16,_[42]),P=i(P,x,b,A,f,23,_[43]),A=i(A,P,x,b,m,4,_[44]),b=i(b,A,P,x,k,11,_[45]),x=i(x,b,A,P,w,16,_[46]),A=s(A,P=i(P,x,b,A,u,23,_[47]),x,b,c,6,_[48]),b=s(b,A,P,x,l,10,_[49]),x=s(x,b,A,P,C,15,_[50]),P=s(P,x,b,A,p,21,_[51]),A=s(A,P,x,b,k,6,_[52]),b=s(b,A,P,x,h,10,_[53]),x=s(x,b,A,P,y,15,_[54]),P=s(P,x,b,A,o,21,_[55]),A=s(A,P,x,b,g,6,_[56]),b=s(b,A,P,x,w,10,_[57]),x=s(x,b,A,P,f,15,_[58]),P=s(P,x,b,A,S,21,_[59]),A=s(A,P,x,b,d,6,_[60]),b=s(b,A,P,x,v,10,_[61]),x=s(x,b,A,P,u,15,_[62]),P=s(P,x,b,A,m,21,_[63]);a[0]=a[0]+A|0,a[1]=a[1]+P|0,a[2]=a[2]+x|0,a[3]=a[3]+b|0},_doFinalize:function(){var e=this._data,r=e.words,i=8*this._nDataBytes,s=8*e.sigBytes;r[s>>>5]|=128<<24-s%32;var n=t.floor(i/4294967296);for(r[15+(s+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),r[14+(s+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),e.sigBytes=4*(r.length+1),this._process(),r=(e=this._hash).words,i=0;4>i;i++)s=r[i],r[i]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8);return e},clone:function(){var t=o.clone.call(this);return t._hash=this._hash.clone(),t}}),n.MD5=o._createHelper(c),n.HmacMD5=o._createHmacHelper(c)}(Math),function(){var t,e=CryptoJS,r=(t=e.lib).Base,i=t.WordArray,s=(t=e.algo).EvpKDF=r.extend({cfg:r.extend({keySize:4,hasher:t.MD5,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var r=(o=this.cfg).hasher.create(),s=i.create(),n=s.words,a=o.keySize,o=o.iterations;n.length<a;){c&&r.update(c);var c=r.update(t).finalize(e);r.reset();for(var _=1;_<o;_++)c=r.finalize(c),r.reset();s.concat(c)}return s.sigBytes=4*a,s}});e.EvpKDF=function(t,e,r){return s.create(r).compute(t,e)}}(),CryptoJS.lib.Cipher||function(t){var e=(p=CryptoJS).lib,r=e.Base,i=e.WordArray,s=e.BufferedBlockAlgorithm,n=p.enc.Base64,a=p.algo.EvpKDF,o=e.Cipher=s.extend({cfg:r.extend(),createEncryptor:function(t,e){return this.create(this._ENC_XFORM_MODE,t,e)},createDecryptor:function(t,e){return this.create(this._DEC_XFORM_MODE,t,e)},init:function(t,e,r){this.cfg=this.cfg.extend(r),this._xformMode=t,this._key=e,this.reset()},reset:function(){s.reset.call(this),this._doReset()},process:function(t){return this._append(t),this._process()},finalize:function(t){return t&&this._append(t),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(t){return{encrypt:function(e,r,i){return("string"==typeof r?f:d).encrypt(t,e,r,i)},decrypt:function(e,r,i){return("string"==typeof r?f:d).decrypt(t,e,r,i)}}}});e.StreamCipher=o.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var c=p.mode={},_=function(t,e,r){var i=this._iv;i?this._iv=void 0:i=this._prevBlock;for(var s=0;s<r;s++)t[e+s]^=i[s]},u=(e.BlockCipherMode=r.extend({createEncryptor:function(t,e){return this.Encryptor.create(t,e)},createDecryptor:function(t,e){return this.Decryptor.create(t,e)},init:function(t,e){this._cipher=t,this._iv=e}})).extend();u.Encryptor=u.extend({processBlock:function(t,e){var r=this._cipher,i=r.blockSize;_.call(this,t,e,i),r.encryptBlock(t,e),this._prevBlock=t.slice(e,e+i)}}),u.Decryptor=u.extend({processBlock:function(t,e){var r=this._cipher,i=r.blockSize,s=t.slice(e,e+i);r.decryptBlock(t,e),_.call(this,t,e,i),this._prevBlock=s}}),c=c.CBC=u,u=(p.pad={}).Pkcs7={pad:function(t,e){for(var r,s=(r=(r=4*e)-t.sigBytes%r)<<24|r<<16|r<<8|r,n=[],a=0;a<r;a+=4)n.push(s);r=i.create(n,r),t.concat(r)},unpad:function(t){t.sigBytes-=255&t.words[t.sigBytes-1>>>2]}},e.BlockCipher=o.extend({cfg:o.cfg.extend({mode:c,padding:u}),reset:function(){o.reset.call(this);var t=(e=this.cfg).iv,e=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var r=e.createEncryptor;else r=e.createDecryptor,this._minBufferSize=1;this._mode=r.call(e,this,t&&t.words)},_doProcessBlock:function(t,e){this._mode.processBlock(t,e)},_doFinalize:function(){var t=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){t.pad(this._data,this.blockSize);var e=this._process(!0)}else e=this._process(!0),t.unpad(e);return e},blockSize:4});var h=e.CipherParams=r.extend({init:function(t){this.mixIn(t)},toString:function(t){return(t||this.formatter).stringify(this)}}),d=(c=(p.format={}).OpenSSL={stringify:function(t){var e=t.ciphertext;return((t=t.salt)?i.create([1398893684,1701076831]).concat(t).concat(e):e).toString(n)},parse:function(t){var e=(t=n.parse(t)).words;if(1398893684==e[0]&&1701076831==e[1]){var r=i.create(e.slice(2,4));e.splice(0,4),t.sigBytes-=16}return h.create({ciphertext:t,salt:r})}},e.SerializableCipher=r.extend({cfg:r.extend({format:c}),encrypt:function(t,e,r,i){i=this.cfg.extend(i);var s=t.createEncryptor(r,i);return e=s.finalize(e),s=s.cfg,h.create({ciphertext:e,key:r,iv:s.iv,algorithm:t,mode:s.mode,padding:s.padding,blockSize:t.blockSize,formatter:i.format})},decrypt:function(t,e,r,i){return i=this.cfg.extend(i),e=this._parse(e,i.format),t.createDecryptor(r,i).finalize(e.ciphertext)},_parse:function(t,e){return"string"==typeof t?e.parse(t,this):t}})),p=(p.kdf={}).OpenSSL={execute:function(t,e,r,s){return s||(s=i.random(8)),t=a.create({keySize:e+r}).compute(t,s),r=i.create(t.words.slice(e),4*r),t.sigBytes=4*e,h.create({key:t,iv:r,salt:s})}},f=e.PasswordBasedCipher=d.extend({cfg:d.cfg.extend({kdf:p}),encrypt:function(t,e,r,i){return r=(i=this.cfg.extend(i)).kdf.execute(r,t.keySize,t.ivSize),i.iv=r.iv,(t=d.encrypt.call(this,t,e,r.key,i)).mixIn(r),t},decrypt:function(t,e,r,i){return i=this.cfg.extend(i),e=this._parse(e,i.format),r=i.kdf.execute(r,t.keySize,t.ivSize,e.salt),i.iv=r.iv,d.decrypt.call(this,t,e,r.key,i)}})}(),function(){for(var t=CryptoJS,e=t.lib.BlockCipher,r=t.algo,i=[],s=[],n=[],a=[],o=[],c=[],_=[],u=[],h=[],d=[],p=[],f=0;256>f;f++)p[f]=128>f?f<<1:f<<1^283;var l=0,g=0;for(f=0;256>f;f++){var m=(m=g^g<<1^g<<2^g<<3^g<<4)>>>8^255&m^99;i[l]=m,s[m]=l;var y=p[l],v=p[y],k=p[v],S=257*p[m]^16843008*m;n[l]=S<<24|S>>>8,a[l]=S<<16|S>>>16,o[l]=S<<8|S>>>24,c[l]=S,S=16843009*k^65537*v^257*y^16843008*l,_[m]=S<<24|S>>>8,u[m]=S<<16|S>>>16,h[m]=S<<8|S>>>24,d[m]=S,l?(l=y^p[p[p[k^y]]],g^=p[p[g]]):l=g=1}var C=[0,1,2,4,8,16,32,64,128,27,54];r=r.AES=e.extend({_doReset:function(){for(var t=(r=this._key).words,e=r.sigBytes/4,r=4*((this._nRounds=e+6)+1),s=this._keySchedule=[],n=0;n<r;n++)if(n<e)s[n]=t[n];else{var a=s[n-1];n%e?6<e&&4==n%e&&(a=i[a>>>24]<<24|i[a>>>16&255]<<16|i[a>>>8&255]<<8|i[255&a]):(a=i[(a=a<<8|a>>>24)>>>24]<<24|i[a>>>16&255]<<16|i[a>>>8&255]<<8|i[255&a],a^=C[n/e|0]<<24),s[n]=s[n-e]^a}for(t=this._invKeySchedule=[],e=0;e<r;e++)n=r-e,a=e%4?s[n]:s[n-4],t[e]=4>e||4>=n?a:_[i[a>>>24]]^u[i[a>>>16&255]]^h[i[a>>>8&255]]^d[i[255&a]]},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._keySchedule,n,a,o,c,i)},decryptBlock:function(t,e){var r=t[e+1];t[e+1]=t[e+3],t[e+3]=r,this._doCryptBlock(t,e,this._invKeySchedule,_,u,h,d,s),r=t[e+1],t[e+1]=t[e+3],t[e+3]=r},_doCryptBlock:function(t,e,r,i,s,n,a,o){for(var c=this._nRounds,_=t[e]^r[0],u=t[e+1]^r[1],h=t[e+2]^r[2],d=t[e+3]^r[3],p=4,f=1;f<c;f++){var l=i[_>>>24]^s[u>>>16&255]^n[h>>>8&255]^a[255&d]^r[p++],g=i[u>>>24]^s[h>>>16&255]^n[d>>>8&255]^a[255&_]^r[p++],m=i[h>>>24]^s[d>>>16&255]^n[_>>>8&255]^a[255&u]^r[p++];d=i[d>>>24]^s[_>>>16&255]^n[u>>>8&255]^a[255&h]^r[p++],_=l,u=g,h=m}l=(o[_>>>24]<<24|o[u>>>16&255]<<16|o[h>>>8&255]<<8|o[255&d])^r[p++],g=(o[u>>>24]<<24|o[h>>>16&255]<<16|o[d>>>8&255]<<8|o[255&_])^r[p++],m=(o[h>>>24]<<24|o[d>>>16&255]<<16|o[_>>>8&255]<<8|o[255&u])^r[p++],d=(o[d>>>24]<<24|o[_>>>16&255]<<16|o[u>>>8&255]<<8|o[255&h])^r[p++],t[e]=l,t[e+1]=g,t[e+2]=m,t[e+3]=d},keySize:8});t.AES=e._createHelper(r)}(),CryptoJS.pad.ZeroPadding={pad:function(t,e){var r=4*e;t.clamp(),t.sigBytes+=r-(t.sigBytes%r||r)},unpad:function(t){for(var e=t.words,r=t.sigBytes-1;!(e[r>>>2]>>>24-r%4*8&255);)r--;t.sigBytes=r+1}};import storage from"@system.storage";import nativeFetch from"@system.fetch";import device from"@system.device";import network from"@system.network";import account from"@service.account";import shortcut from"@system.shortcut";import file from"@system.file";import md5 from"md5";import app from"@system.app";import router from"@system.router";import APP_CONFIG from"./statistics.config";const __path__={ids:"internal://files/wanka/data.txt",icon:"internal://files/wanka/icon.txt"};function isObject(t){return null!==t&&"object"==typeof t}function isArray(t){return Array.isArray(t)}function isEmptyObject(t){for(let e in t)return!1;return!0}function isPlainObject(t){if("object"!=typeof t||null==t)return!1;if(null===Object.getPrototypeOf(t))return!0;let e=t;for(;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function to_query_string(t){let e="";for(let r in t)e+=r+"="+t[r]+"&";return e=e.substring(0,e.length-1)}function to_string(t){return"string"==typeof t?t:JSON.stringify(t)}function today_date(){return parseInt(Date.now()/864e5)}function encrypt(t,e){let r=md5("huanju@quickapp"+e).substring(16).toLowerCase(),i=CryptoJS.enc.Latin1.parse(r),s=CryptoJS.enc.Latin1.parse("2018080716102000");return CryptoJS.AES.encrypt(t,i,{iv:s,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.ZeroPadding}).toString()}function decrypt(t,e){try{let r=md5("huanju@quickapp"+e).substring(16).toLowerCase(),i=CryptoJS.enc.Latin1.parse(r),s=CryptoJS.enc.Latin1.parse("2018080716102000");return CryptoJS.AES.decrypt(t,i,{iv:s,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.ZeroPadding}).toString(CryptoJS.enc.Latin1)}catch(t){console.log(t)}}function random_str(){return(268435456*(1+Math.random())|0).toString(16)}function create_cuid(t){let e=t||random_str();return md5(Date.now()+"-"+random_str()+"-"+random_str()+"-"+random_str()+"-"+e)}function create_req_id(t){let e=Date.now()+random_str()+random_str()+(t||random_str());return md5(e)}function check_ev_id(t){return"string"==typeof t&&""!==t&&/^[0-9a-zA-Z_\u4e00-\u9fa5]{1,255}$/.test(t)}function check_ev_args(t){let e=/^[0-9a-zA-Z_\u4e00-\u9fa5]{0,255}$/,r=0;if("string"==typeof t&&e.test(t))return!0;if(isPlainObject(t)){for(let i in t){let s=t[i];if("string"!=typeof i&&"number"!=typeof i||!/^[0-9a-zA-Z_\u4e00-\u9fa5]{1,255}$/.test(i))return!1;if("string"!=typeof s&&"number"!=typeof s||!e.test(s))return!1;r++}return!(r>100)}return!1}const FETCH={get:function(t){let{url:e,timeout:r}=t,i=new Promise((t,r)=>{try{nativeFetch.fetch({url:config.url+e,success:function(e){t(e)},fail:function(e,r){t(e)}})}catch(t){}}),s=new Promise((t,e)=>{setTimeout(()=>{t({code:204,massage:"Request timed out"})},r||3e3)});return Promise.race([s,i])}};function submit_action(t){return FETCH.get({url:"/a.gif?"+t})}function submit_err(t){return FETCH.get({url:"/e.gif?"+t})}function set_storage(...t){return new Promise((e,r)=>{try{storage.set({key:t[0],value:t[1]||"",success:function(t){e(!0)},fail:function(t){e(!1)}})}catch(t){e(!1)}})}function get_storage(t){return new Promise((e,r)=>{try{storage.get({key:t,success:function(t){e(t)},fail:function(t,r){e(!1)}})}catch(t){e(!1)}})}function del_storage(t){return new Promise((e,r)=>{try{storage.delete({key:t,success:function(t){e(t)},fail:function(t,r){e(!1)}})}catch(t){e(!1)}})}function read_text_file(t){return new Promise((e,r)=>{file.readText({uri:t,success:function(t){e(t)},fail:function(t,r){e(!1)}})})}function write_text_file(t,e){return new Promise((r,i)=>{try{file.writeText({uri:t,text:e,success:function(){r(!0)},fail:function(t,e){r(!1)}})}catch(t){}})}const DATAS_API={deviceIds:()=>new Promise((t,e)=>{try{device.getId({type:["device","mac"],success:function(e){t(e)},fail:function(e,r){t({})}})}catch(e){t({})}}),getUserId:()=>new Promise((t,e)=>{try{device.getUserId({success:function(e){t(e)},fail:function(e,r){t({})}})}catch(e){t({})}}),deviceInfos:()=>new Promise((t,e)=>{try{device.getInfo({success:function(e){t(e)},fail:function(){t({})}})}catch(e){t({})}}),netType:()=>new Promise((t,e)=>{try{network.getType({success:function(e){t(e)},fail:function(){t({})}})}catch(e){t({})}}),has_shortcut:()=>new Promise((t,e)=>{try{shortcut.hasInstalled({success:function(e){t({has_icon:e?1:0})},fail:function(){t({has_icon:0})}})}catch(e){t({has_icon:0})}})},BASE_DATA={sdk_version:"1.4.1.0",sdk_version_code:1403,debug:0},CUID_KEY="_SD_BD_CUID_",ICON_STATE_KEY="_SD_BD_ICON_STATE_",ERR_MSG_INFO="_SD_BD_ERR_MSG_INFO_",RESTARTINTERVAL=3e4,LOG_STATE={has_init:!1,has_cuid_storage:!1,has_open_log:!1};class Wanka_statistic{constructor(){this.state={is_entry:1,cuid:"",req:"",log_list:[],data:null,page:null,lastday_icon_state:0,today_icon_state:0,n_u_mark:0,icon_states:null},this.init=this.init.bind(this),this.page_stat=this.page_stat.bind(this),this.page_end=this.page_end.bind(this),this.merge_datas=this.merge_datas.bind(this),this.save_to_queue=this.save_to_queue.bind(this),this.handle_submit=this.handle_submit.bind(this),this.send_queue=this.send_queue.bind(this),this.event_log=this.event_log.bind(this),this.err_report=this.err_report.bind(this),this.isReStart=this.isReStart.bind(this),this.reStart=this.reStart.bind(this),this.get_app_info=this.get_app_info.bind(this),this.combine_err_data=this.combine_err_data.bind(this)}init(t){LOG_STATE.has_init=!0;let e={},r=t||{_def:{}};r._def=r._def||{manifest:{}};let i,{_def:{manifest:s}}=r;try{i=app.getInfo()}catch(t){let e={err_msg:to_string(t.stack)||"",err_site:"app.getInfo"};$statistic.err_report(e)}e.package=s.package||i.packageName,e.versionName=i.versionName||s.versionName,e.minPlatformVersion=s.minPlatformVersion||"",e.name=s.name||i.name,e.source=i.source&&i.source.type,e.extra=i.source&&i.source.extra;try{e.channel=account.getProvider()}catch(t){let e={err_msg:to_string(t.stack)||"",err_site:"account.getProvider"};$statistic.err_report(e)}Promise.all([DATAS_API.deviceInfos(),DATAS_API.getUserId(),DATAS_API.netType(),DATAS_API.has_shortcut()]).then(t=>{let r=Object.assign(e,...t),i={};this.state.today_icon_state=t[3].has_icon,Promise.all([get_storage(CUID_KEY),read_text_file(__path__.ids),get_storage(ICON_STATE_KEY),read_text_file(__path__.icon)]).then(t=>{let e=t[0],s=t[1];t[2],t[3];e||s?e&&s?(i.cuid=e,i.n_u_mark=this.state.n_u_mark=1):(i.cuid=e||JSON.parse(s.text)[CUID_KEY],this.save_uuids_to_client(i.cuid),i.n_u_mark=this.state.n_u_mark=1):(i.cuid=create_cuid(r.userId||""),this.save_uuids_to_client(i.cuid),i.n_u_mark=this.state.n_u_mark=0),this.state.cuid=i.cuid,i.req=this.state.req=create_req_id(i.cuid),this.state.data=Object.assign({},format_datas.device(r,this.state.cuid),format_datas.public(i))})})}get_app_info(t){let e={},r={};try{r=app.getInfo()}catch(t){let e={err_msg:to_string(t.stack)||"",err_site:"app.getInfo"};$statistic.err_report(e)}e.package=r.packageName,e.versionName=r.versionName,e.name=r.name,e.source=r.source&&r.source.type,e.extra=r.source&&r.source.extra;try{e.channel=account.getProvider()}catch(t){let e={err_msg:to_string(t.stack)||"",err_site:"account.getProvider"};$statistic.err_report(e)}DATAS_API.deviceInfos().then(r=>{e=Object.assign(e,r);let i=Object.assign({},format_datas.device(e,this.state.cuid),format_datas.public({}));t&&t(i)})}page_stat(t){let e,r,i;Promise.all([DATAS_API.has_shortcut(),get_storage(ICON_STATE_KEY),read_text_file(__path__.icon)]).then(t=>{let e=t[0].has_icon,r=t[1]||t[2].text,i=today_date();if(r||(this.state.lastday_icon_state=this.state.lastday_icon_state||0,this.icon_states={tod_state:{update_time:i,state:e},last_state:{update_time:i,state:this.state.lastday_icon_state}}),r){let t=JSON.parse(r);i!=t.tod_state.update_time?(this.state.lastday_icon_state=t.tod_state.state,this.icon_states={tod_state:{update_time:i,state:e},last_state:{update_time:t.tod_state.update_time,state:t.tod_state.state}}):(this.state.lastday_icon_state=t.last_state.state,e!=t.tod_state.state&&(this.icon_states=Object.assign({},t,{tod_state:{update_time:i,state:e}})))}this.state.data.t_icon_state=e==this.state.lastday_icon_state?2:e,this.state.data.has_icon=e});try{r=(e=router.getState()||{}).name,i=e.path}catch(t){let e={err_msg:to_string(t.stack)||"",err_site:"router.getState"};$statistic.err_report(e)}try{this.isReStart(r)&&this.reStart()}catch(t){let e={err_msg:to_string(t.stack)||"",err_site:"computed reStart"};$statistic.err_report(e)}this.state.page=format_datas.page({sta_time:Date.now(),page_name:r||"",page_path:i||"",is_entry:this.state.is_entry||0}),this.state.is_entry=0,LOG_STATE.has_open_log=!0}page_end(t){try{today_date();let t=Date.now();if(!this.state.cuid||!this.state.data)return;if(this.state.page)this.state.page.duration=t-this.state.page.sta_time,this.state.page.end_time=t,this.handle_submit({},()=>{null!=this.icon_states&&this.update_icon_state({},this.icon_states)});else{let t={err_msg:"this.state.page is"+this.state.page,err_site:"get_page_data"};$statistic.err_report(t)}}catch(t){console.log("error",t)}}isReStart(t){let e=this.state.page||{page_name:"",end_time:0};if(""==e.end_time)return!1;let r=Date.now()-e.end_time;return t&&t===e.page_name&&r>=RESTARTINTERVAL}reStart(){this.state.is_entry=1,this.state.req=create_req_id(this.state.cuid),this.state.data&&(this.state.data.req_id=this.state.req)}merge_datas(){return Object.assign(this.state.data||{},this.state.page||{},BASE_DATA)}handle_submit(t={},e){let r=Object.assign({},this.merge_datas(),t),i=to_query_string(r),s=encrypt(i,r.cuid);submit_action(to_query_string({package:r.package,svr:r.svr,cuid:r.cuid,en_code:"cuid",sdk_version:r.sdk_version,sdk_version_code:r.sdk_version_code,action:r.action,params:s})).then(t=>{200==t.code?(this.send_queue(),e&&e()):this.save_to_queue(i)}).catch(t=>{this.save_to_queue(i)})}save_to_queue(t){let e=this.state.log_list&&this.state.log_list.length;return e&&e<50&&this.state.log_list.push(t+"&retry=1"),this.state.log_list}send_queue(){try{let t=[...this.state.log_list];this.state.log_list=[],t.forEach(t=>{submit_action(t).then(e=>{200!=e.code&&this.save_to_queue(t)}).catch(e=>{this.save_to_queue(t)})})}catch(t){console.log("error",t)}}event_log(t={}){if(!this.state.req)return void console.error("event err:Please execute the “track_event” after the initialization is complete");let e=Object.assign({},t,{action:3});this.handle_submit(e)}err_report(t={}){if(this.state.data.svr)this.combine_err_data(Object.assign({},this.merge_datas(),t));else try{this.get_app_info((e={})=>{this.combine_err_data(Object.assign({},e,t))})}catch(t){}}combine_err_data(t={}){let e=Object.assign({action:9,err_time:(new Date).getTime(),err_id:""},t);e.app_id=APP_CONFIG.app_key||"";let r=encrypt(to_query_string(e),e.cuid),i={package:e.package||"",svr:e.svr,app_id:e.app_id||"",cuid:e.cuid||"",en_code:"cuid",sdk_version:e.sdk_version||"",sdk_version_code:e.sdk_version_code,action:e.action||"",params:r};get_storage(ERR_MSG_INFO).then(t=>{let e=(new Date).getDate(),r={day:e,len:0};if(t)try{r=JSON.parse(t)}catch(t){}r.day!==e&&(r.len=0),r.len<50&&++r.len,r.len>50||submit_err(to_query_string(i)).then(t=>{set_storage(ERR_MSG_INFO,to_string(r)).then()})}).catch()}save_uuids_to_client(t){set_storage(CUID_KEY,t).then(t=>{t&&(LOG_STATE.has_cuid_storage=!0)});let e={};e[CUID_KEY]=t,write_text_file(__path__.ids,e).then(t=>{})}update_icon_state(t,e=""){set_storage(ICON_STATE_KEY,e).then(t=>{}),write_text_file(__path__.icon,e).then(t=>{})}}const format_datas={device:(t,e)=>({package:t.package||"",channel:(t.channel||"").toLowerCase(),name:t.name||"",svr:t.versionName||"",client_id:encrypt(t.device||"",e),info_ma:encrypt(t.mac||"",e),os_id:encrypt(t.userId||"",e),make:(t.brand||"").toLowerCase(),manufacturer:(t.manufacturer||"").toLowerCase(),model:(t.model||"").toLowerCase(),product:(t.product||"").toLowerCase(),os_type:(t.osType||"").toLowerCase(),ovr:(t.osVersionName||"").toLowerCase(),pla_ver:t.platformVersionCode||"",lan:(t.language||"").toLowerCase(),region:(t.region||"").toLowerCase(),px:(t.screenWidth||"")+"*"+(t.screenHeight||""),net:(t.type||"").toLowerCase(),has_icon:t.has_icon||0,source:(t.source||"").toLowerCase(),extra:to_string(t.extra||"").toLowerCase(),t_icon_state:t.t_icon_state||2}),page:(t={})=>Object.assign({page_name:"",page_path:"",sta_time:"",end_time:"",duration:"",is_entry:0},t),public:t=>({app_id:APP_CONFIG.app_key||"",cuid:t.cuid||"",req_id:t.req||"",en_code:"cuid",action:2,n_u_mark:t.n_u_mark||0})},$statistic=new Wanka_statistic;function Page_Config(t){let e=t.onShow,r=t.onHide;return t.onShow=function(){API.page_show(this),e&&e.call(this)},t.onHide=function(){API.page_hide(this),r&&r.call(this)},t}const API={open_app(t){try{if(!APP_CONFIG.app_key)return void console.error("Not configured app_key!");$statistic.init(t)}catch(t){let e={err_msg:to_string(t.stack)||"",err_site:"open_app"};$statistic.err_report(e)}},page_show(t){try{$statistic.page_stat(t)}catch(t){let e={err_msg:to_string(t.stack)||"",err_site:"page_show"};$statistic.err_report(e)}},page_hide(t){try{LOG_STATE.has_init&&LOG_STATE.has_open_log&&$statistic.page_end(t)}catch(t){let e={err_msg:to_string(t.stack)||"",err_site:"open_app"};$statistic.err_report(e)}LOG_STATE.has_open_log=!1},track_event(t,e){try{if(!APP_CONFIG.app_key)return void console.error("Not configured app_key!");let r=null==e?"":e;if(!check_ev_id(t))return void console.error('"event error": please check track_event id. id should be "string" and not null.');if(!check_ev_args(r))return void console.error('"event error":  please check track_event parameter. parameter should be "string" or "object"');$statistic.event_log({ev_id:t,ev_args:"string"==typeof r?r:to_string(r)})}catch(t){let e={err_msg:to_string(t.stack)||"",err_site:"track_event"};$statistic.err_report(e)}},on_err(t){try{if(!APP_CONFIG.app_key)return void console.error("Not configured app_key!");let e={err_msg:to_string(t.stack)||"",err_site:"",action:8,err_id:md5(t.message.replace(/^[\S\s]+:/,""))};$statistic.err_report(e)}catch(t){let e={err_msg:to_string(t.stack)||"",err_site:"on_err"};$statistic.err_report(e)}}},sdk_api={app_sta_init:API.open_app,page_show:API.page_show,page_hide:API.page_hide,track_event:API.track_event,on_err:API.on_err},hookTo=global.__proto__||global;hookTo.APP_STATISTICS=sdk_api,hookTo.Custom_page=APP_STATISTICS.Custom_page=Page_Config;export default sdk_api;